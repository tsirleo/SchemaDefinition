# Task_1 Var_P2

## Робот в лабиринте

Требуется дополнить схемы в прилагающемся файле **lab.circ** схемой управления роботом, передвигающимся по лабиринту размера 4x4.

## Терминология

M[i,j] — так будем обозначать ячейку лабиринта в i -й строке и j -м столбце, нумерация с ноля.

Флаг = сигнал ширины 1. Флаг поднят = сигнал имеет значение 1. Флаг опущен = сигнал имеет значение 0. Флаг поднимается = передний фронт сигнала. Флаг опускается = задний фронт сигнала.

## Схема управления роботом

### Порты

**Входы:**

- ***clk***, ширина 1: тактовый.
- ***rst***, ширина 1: асинхронный сброс.
- ***start***, ширина 1: флаг начала движения.
- ***xrow***, ширина 2: ряд цели.
- ***xcol***, ширина 2: столбец цели.
- Проходы лабиринта. Значение сигнала 1 означает, что в указанном месте расположен проход, 0 препятствие (стена, прохода нет). Проходы передаются через 7 шин, места перечисляются от старшего (левого) бита к младшему:

  - ***r1***, ширина 3: проходы между **M[0,0]** и **M[0,1]**, **M[0,1]** и **M[0,2]**, **M[0,2]** и **M[0,3]**.
  - ***r2***, ширина 4: проходы между **M[0,0]** и **M[1,0]**, **M[0,1]** и **M[1,1]**, **M[0,2]** и **M[1,2]**, **M[0,3]** и **M[1,3]**.
  - ***r3***, ширина 3: проходы между **M[1,0]** и **M[1,1]**, **M[1,1]** и **M[1,2]**, **M[1,2]** и **M[1,3]**.
  - ***r4***, ширина 4: проходы между **M[1,0]** и **M[2,0]**, **M[1,1]** и **M[2,1]**, **M[1,2]** и **M[2,2]**, **M[1,3]** и **M[2,3]**.
  - ***r5***, ширина 3: проходы между **M[2,0]** и **M[2,1]**, **M[2,1]** и **M[2,2]**, **M[2,2]** и **M[2,3]**.
  - ***r6***, ширина 4: проходы между **M[2,0]** и **M[3,0]**, **M[2,1]** и **M[3,1]**, **M[2,2]** и **M[3,2]**, **M[2,3]** и **M[3,3]**.
  - ***r7***, ширина 3: проходы между **M[3,0]** и **M[3,1]**, **M[3,1]** и **M[3,2]**, **M[3,2]** и **M[3,3]**.

**Выходы:**

- ***row***, ширина 2: ряд.
- ***col***, ширина 2: столбец.
- ***dir***, ширина 2: направление.
- ***active***, ширина 1: флаг активности робота.

### Устройство

Флаг ***active*** после сброса опущен (робот неактивен), при поднятии флага ***start*** немедленно поднимается (теперь робот активен), по достижении цели (когда координаты робота становятся равны координатам цели) немедленно опускается (и робот снова неактивен). При разработке и моделировании схемы следует считать, что если цель достигнута, то флаг ***start*** *обязательно* опущен.
В остальном это синхронная схема, устроенная так:

Всевозможные направления робота:

- вверх (0) — от второго ряда к первому;
- вниз (1) — от первого ряда ко второму;
- вправо (2) — от первого столбца ко второму;
- влево (3) — от второго столбца к первому.

У робота всегда есть положение (ряд и столбец) и направление, непрерывно выводящиеся в выходы ***row***, ***col*** и ***dir*** соответственно. После сброса робот устанавливается в левый верхний угол (ряд 0, столбец 0) и направлен вверх.

*"Впереди", "слева", "справа"* и *"сзади"* в описании ниже считаются относительно текущего положения и текущего направления естественным образом.

Робот движется только во время переднего фронта тактового сигнала, только если активен (иначе стоит без движения), и делает это так (все действия — во время одного фронта):

- Если впереди есть проход, то робот движется вперёд на одну ячейку.
- Иначе если справа есть проход, то робот поворачивается на 90 градусов по часовой стрелке (вправо) и движется вперёд на одну ячейку.
- Иначе если слева есть проход, то робот поворачивается на 90 градусов против часовой стрелки (влево) и движется вперёд на одну ячейку.
- Иначе если сзади есть проход, то робот разворачивается на 180 градусов и движется вперёд на одну ячейку.
- Иначе робот стоит на месте.

# Task_1 Var_P2

## Робот в лабиринте

Требуется дополнить схемы в прилагающемся файле **lab.circ** схемой управления роботом, передвигающимся по лабиринту размера 4x4.

## Терминология

M[i,j] — так будем обозначать ячейку лабиринта в i -й строке и j -м столбце, нумерация с ноля.

Флаг = сигнал ширины 1. Флаг поднят = сигнал имеет значение 1. Флаг опущен = сигнал имеет значение 0. Флаг поднимается = передний фронт сигнала. Флаг опускается = задний фронт сигнала.

## Схема управления роботом

### Порты

**Входы:**

- ***clk***, ширина 1: тактовый.
- ***rst***, ширина 1: асинхронный сброс.
- ***start***, ширина 1: флаг выполнения действия.
- ***act***, ширина 2: действие для выполнения
- Проходы лабиринта. Значение сигнала 1 означает, что в указанном месте расположен проход, 0 препятствие (стена, прохода нет). Проходы передаются через 7 шин, места перечисляются от старшего (левого) бита к младшему:

  - ***r1***, ширина 3: проходы между **M[0,0]** и **M[0,1]**, **M[0,1]** и **M[0,2]**, **M[0,2]** и **M[0,3]**.
  - ***r2***, ширина 4: проходы между **M[0,0]** и **M[1,0]**, **M[0,1]** и **M[1,1]**, **M[0,2]** и **M[1,2]**, **M[0,3]** и **M[1,3]**.
  - ***r3***, ширина 3: проходы между **M[1,0]** и **M[1,1]**, **M[1,1]** и **M[1,2]**, **M[1,2]** и **M[1,3]**.
  - ***r4***, ширина 4: проходы между **M[1,0]** и **M[2,0]**, **M[1,1]** и **M[2,1]**, **M[1,2]** и **M[2,2]**, **M[1,3]** и **M[2,3]**.
  - ***r5***, ширина 3: проходы между **M[2,0]** и **M[2,1]**, **M[2,1]** и **M[2,2]**, **M[2,2]** и **M[2,3]**.
  - ***r6***, ширина 4: проходы между **M[2,0]** и **M[3,0]**, **M[2,1]** и **M[3,1]**, **M[2,2]** и **M[3,2]**, **M[2,3]** и **M[3,3]**.
  - ***r7***, ширина 3: проходы между **M[3,0]** и **M[3,1]**, **M[3,1]** и **M[3,2]**, **M[3,2]** и **M[3,3]**.

**Выходы:**

- ***row***, ширина 2: ряд.
- ***col***, ширина 2: столбец.
- ***dir***, ширина 2: направление.
- ***active***, ширина 1: флаг активности робота.

### Устройство

Флаг ***active*** после сброса опущен (робот неактивен). При поднятии флага start флаг активности тоже немедленно поднимается (теперь робот активен), после этого робот выполняет действие как описано ниже, и по завершении действия флаг ***active*** немедленно опускается (робот снова неактивен). При разработке и моделировании схемы следует считать, что во время выполнения действия флаг ***start*** опущен.
В остальном это синхронная схема, устроенная так:

**Всевозможные направления робота:**

- вверх (0) — от второго ряда к первому;
- вниз (1) — от первого ряда ко второму;
- вправо (2) — от первого столбца ко второму;
- влево (3) — от второго столбца к первому.

У робота всегда есть положение (ряд и столбец) и направление, непрерывно выводящиеся в выходы ***row***, ***col*** и ***dir*** соответственно. После сброса робот устанавливается в правый нижний угол (ряд 3, столбец 3) и направлен вверх.

Если **active(t) = 1** и робот не находится в режиме выполнения действия в этот момент, то он переходит в режим выполнения действия. После сброса робот не находится в режиме выполнения действия.

**Находясь в режиме выполнения действия, робот делает следующее:**

- Если **act = 0**, то поворачивается на 90 градусов по часовой стрелке (вправо) и немедленно выходит из режима выполнения действия. Действие завершено.
- Если **act = 1**, то поворачивается на 90 градусов против часовой стрелки (влево) и немедленно выходит из режима выполнения действия. Действие завершено.
- Если **act = 2**, то поворачивается на 180 градусов и немедленно выходит из режима выполнения действия. Действие завершено.
- Если **act = 3**, то робот движется вперёд до упора: если впереди по направлению ***dir*** есть проход, то он перемещается на одну ячейку вперёд и остаётся в режиме выполнения действия, а иначе остаётся на месте и немедленно выходит из режима выполнения действия, и во время выхода из режима действие завершается.
